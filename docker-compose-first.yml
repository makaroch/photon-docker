version: '3.9'

services:
  photon:
    image: komoot/photon:0.7
    container_name: photon
    ports:
      - "2322:2322"
    volumes:
      - ./photon_data:/photon_data
    environment:
      # –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ ‚Äî –º–æ–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å —è–∑—ã–∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
      - PHOTON_LANGUAGE=ru
    command: >
      bash -c "
        if [ ! -d /photon_data/es_data ]; then
          echo '‚û°Ô∏è  –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ Photon —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —Ä—É—Å—Å–∫–æ–≥–æ —è–∑—ã–∫–∞...';
          wget -O /photon_data/photon-dump.jsonl.zst https://download1.graphhopper.com/public/europe/germany/photon-dump-germany-0.7-latest.jsonl.zst &&
          zstd --stdout -d /photon_data/photon-dump.jsonl.zst |
          java -jar photon.jar -nominatim-import -languages en,de,fr,ru,local -import-file - &&
          echo '‚úÖ –ò–º–ø–æ—Ä—Ç –∑–∞–≤–µ—Ä—à—ë–Ω';
        else
          echo 'üì¶ –î–∞–Ω–Ω—ã–µ —É–∂–µ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã, –∑–∞–ø—É—Å–∫–∞–µ–º —Å–µ—Ä–≤–µ—Ä Photon...';
        fi;
        java -jar photon.jar -data-dir /photon_data/es_data
      "
